swagger: '2.0'
info:
  version: 'v1'
  title: 'Services API'
  contact:
    email: hello@overops.com
  description: |
    Main OverOps API.

    All calls must be authenticated using one of the following methods:
      1. Using `username:password`.
      2. Using `x-api-key` header (To generate the token, go to `Settings` --> `Account Settings` in the OverOps App)

securityDefinitions:
  basicAuth:
    type: basic
  ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
security:
  - basicAuth: []
  - ApiKeyAuth: []
host: api.overops.com
basePath: /api/v1
tags:
  - name: General
    description: Fetching general information about services (Not yet implemented)
  - name: Data Redaction
    description: Fetching and manipulating the data redaction (PII) settings of the service
  - name: Code Redaction
    description: Fetching and manipulating the 3rd party and utility classes settings.
  - name: Views
    description: Fetching information about the views
  - name: View Metrics
    description: Fetching data points about views in order to plot graphs
  - name: Alerts
    description: APIs related to the alerting mechanism
  - name: Events
    description: Event data
schemes:
- "https"
paths:
  /services:
    get:
      tags:
        - General
      description: "List all services"
      responses:
        200:
          description: TBD
        401:
          description: Unauthorized
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}:
    get:
      tags:
        - General
      summary: "Get information about the service"
      description: "Get information about the service"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
      responses:
        200:
          description: TBD
        401:
          description: Unauthorized
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings:
    get:
      tags:
        - General
      summary: "Get service settings"
      description: "Get service settings"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: TBD
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction:
    get:
      tags:
        - Code Redaction
      summary: "List all environment code redaction"
      description: "List all environment code exclusions and inclusions"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of included and excluded classes and packages
          schema:
            properties:
              exclude:
                type: "object"
                properties:
                  classes:
                    type: "array"
                    items:
                      $ref: "#/definitions/ExcludedClassName"
                  packages:
                    type: "array"
                    items:
                      $ref: "#/definitions/ExcludedPackageName"
              include:
                type: "object"
                properties:
                  classes:
                    type: "array"
                    items:
                      $ref: "#/definitions/IncludedClassName"
                  packages:
                    type: "array"
                    items:
                      $ref: "#/definitions/IncludedPackageName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/exclude:
    get:
      tags:
        - Code Redaction
      summary: "List all code exclusions"
      description: "List all code exclusions"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of excluded classes and packages
          schema:
            properties:
              classes:
                type: "array"
                items:
                  $ref: "#/definitions/ExcludedClassName"
              packages:
                type: "array"
                items:
                  $ref: "#/definitions/ExcludedPackageName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/exclude/classes:
    get:
      tags:
        - Code Redaction
      summary: "List all excluded classes"
      description: "List all excluded classes"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of excluded classes
          schema:
            properties:
              classes:
                type: "array"
                items:
                  $ref: "#/definitions/ExcludedClassName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/exclude/classes/{class_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: class_name
        type: string
        required: true
        description: Fully qualified Java class name
      - in: path
        name: class_name
        type: string
        required: true
        description: Fully qualified Java class name
    get:
      tags:
        - Code Redaction
      summary: "Retrieve an excluded class"
      description: "Retrieve an excluded class"
      responses:
        200:
          description: An excluded class
          schema:
            properties:
              name:
                $ref: "#/definitions/ExcludedClassName"
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Code Redaction
      summary: "Add a class to the exclusion list"
      description: "Add a class to the exclusion list. The body class name must match the resource identifier"
      parameters:
       - in: body
         name: class
         schema:
           properties:
              name:
                $ref: "#/definitions/ExcludedClassName"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Code Redaction
      summary: "Remove a class from exclusion"
      description: "Remove a class from the exclusion list"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/exclude/packages:
    get:
      tags:
        - Code Redaction
      summary: "List all excluded packages"
      description: "List all excluded packages"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of excluded packages
          schema:
            properties:
              packages:
                type: "array"
                items:
                  $ref: "#/definitions/ExcludedPackageName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/exclude/packages/{package_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: package_name
        type: string
        required: true
        description: Fully qualified Java package name
    get:
      tags:
        - Code Redaction
      summary: "Retrieve an excluded package"
      description: "Retrieve an excluded package"
      responses:
        200:
          description: An excluded package
          schema:
            properties:
              name:
                $ref: "#/definitions/ExcludedPackageName"
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Code Redaction
      summary: "Add a package to the exclusion list"
      description: "Add a package to the exclusion list. The body package name must match the resource identifier"
      parameters:
       - in: body
         name: package
         schema:
           properties:
              name:
                $ref: "#/definitions/ExcludedPackageName"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Code Redaction
      summary: "Remove a package from the exclusion list"
      description: "Remove a package from the exclusion list"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/include:
    get:
      tags:
        - Code Redaction
      summary: "List all code inclusions"
      description: "List all code inclusions"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of included classes and packages
          schema:
            properties:
              classes:
                type: "array"
                items:
                  $ref: "#/definitions/IncludedClassName"
              packages:
                type: "array"
                items:
                  $ref: "#/definitions/IncludedPackageName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/include/classes:
    get:
      tags:
        - Code Redaction
      summary: "List all included classes"
      description: "List all included classes"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of included classes
          schema:
            properties:
              classes:
                type: "array"
                items:
                  $ref: "#/definitions/IncludedClassName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/include/classes/{class_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: class_name
        type: string
        required: true
        description: Fully qualified Java class name
    get:
      tags:
        - Code Redaction
      summary: "Retrieve an included class"
      description: "Retrieve an included class"
      responses:
        200:
          description: An included class
          schema:
            properties:
              name:
                $ref: "#/definitions/IncludedClassName"
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Code Redaction
      summary: "Add a class to the inclusion list"
      description: "Add a class to the inclusion list. The body class name must match the resource identifier"
      parameters:
       - in: body
         name: class
         schema:
           properties:
              name:
                $ref: "#/definitions/IncludedClassName"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Code Redaction
      summary: "Remove a class from the inclusion list"
      description: "Remove a class from the inclusion list"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/include/packages:
    get:
      tags:
        - Code Redaction
      summary: "List all included packages"
      description: "List all included packages"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of included packages
          schema:
            properties:
              packages:
                type: "array"
                items:
                  $ref: "#/definitions/IncludedPackageName"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/code-redaction/include/packages/{package_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: package_name
        type: string
        required: true
        description: Fully qualified Java package name
    get:
      tags:
        - Code Redaction
      summary: "Retrieve an included package"
      description: "Retrieve an included package"
      responses:
        200:
          description: An included package
          schema:
            properties:
              name:
                $ref: "#/definitions/IncludedPackageName"
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Code Redaction
      summary: "Add a package to the inclusion list"
      description: "Add a package to the inclusion list. The body package name must match the resource identifier"
      parameters:
       - in: body
         name: package
         schema:
           properties:
              name:
                $ref: "#/definitions/IncludedPackageName"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Code Redaction
      summary: "Remove a package from the inclusion list"
      description: "Remove a package from the inclusion list"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction:
    get:
      tags:
        - Data Redaction
      summary: "List all data redactions"
      description: "List all data redactions"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of data redaction
          schema:
            properties:
              packages:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "com.example"
              patterns:
                type: "array"
                items:
                  $ref: "#/definitions/Pattern"
              identifiers:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "password"
              classes:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "IPv4"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/patterns:
    get:
      tags:
        - Data Redaction
      summary: "List all regex patterns"
      description: "List all regex patterns"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of regex patterns
          schema:
            properties:
              patterns:
                type: "array"
                items:
                  $ref: "#/definitions/Pattern"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/patterns/{pattern}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: pattern
        description: A RegEx pattern name
        type: string
        required: true
    get:
      tags:
        - Data Redaction
      summary: "Retrieve a pattern"
      description: "Retrieve a pattern"
      responses:
        200:
          description: A pattern
          schema:
            $ref: '#/definitions/Pattern'
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Data Redaction
      summary: "Create a pattern"
      description: "Add a RegEx pattern to be redacted. The pattern name must match the resource identifier"
      parameters:
        - in: body
          name: pattern
          schema:
            $ref: '#/definitions/Pattern'
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Data Redaction
      summary: "Delete a pattern"
      description: "Removes a pattern from the redaction list"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/identifiers:
    get:
      tags:
        - Data Redaction
      summary: "List all identifiers"
      description: "List all identifiers"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of identifiers
          schema:
            properties:
              identifiers:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "password"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/identifiers/{identifier}:
    get:
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: identifier
          description: A code identifier
          type: string
          required: true
      tags:
        - Data Redaction
      summary: "Retrieve an identifier"
      description: "Retrieve an identifier"
      responses:
        200:
          description: If the redaction exists
          schema:
            properties:
              name:
                type: "string"
                example: "password"
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Data Redaction
      summary: "Add an identifier"
      description: "Add an identifier. The body identifier name must match the resource identifier"
      operationId: addIdentifier
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: identifier
          description: A code identifier
          type: string
          required: true
        - name: name
          in: body
          description: Identifier object
          schema:
           properties:
             name:
               type: "string"
               example: "password"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Data Redaction
      summary:  "Delete identifier"
      description: "Delete identifier"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/classes:
    get:
      tags:
        - Data Redaction
      summary: "List all classes"
      description: "List all classes"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of classes
          schema:
            properties:
              classes:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "IPv4"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/classes/{class_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: class_name
        description: Class name to redact.
        type: string
        required: true
    get:
      tags:
        - Data Redaction
      summary: "Retrieve a class"
      description: "Retrieve a class from the data redaction list"
      responses:
        200:
          description: If the redaction exists
          schema:
            properties:
              name:
                type: "string"
                example: "IPv4"
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Data Redaction
      summary: "Add a class for data redaction"
      description: "Add a class to the redaction list. The body class name must match the resource identifier"
      parameters:
       - in: body
         description: A JSON representing a class to add for redaction
         name: name
         schema:
          properties:
            name:
              type: "string"
              example: "IPv4"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Data Redaction
      summary:  "Delete a class"
      description: "Delete a class"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/packages:
    get:
      tags:
        - Data Redaction
      summary: "List all packages"
      description: "List all packages"
      parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
      responses:
        200:
          description: List of packages
          schema:
            properties:
              packages:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name:
                      type: "string"
                      example: "com.example"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/settings/data-redaction/packages/{package_name}:
    parameters:
      - in: path
        name: service_id
        description: Environment to use
        type: string
        required: true
      - in: path
        name: package_name
        description: Fully qualified Java package name
        type: string
        required: true
    get:
      tags:
        - Data Redaction
      summary: "Retrieve a package"
      description: "Retrieve a package"
      responses:
        200:
          description: If the redaction exists
          schema:
            properties:
              name:
                type: "string"
                example: "com.example"
        401:
          $ref: "#/definitions/UnauthorizedError"
    put:
      tags:
        - Data Redaction
      summary: "Create a package"
      description: "Create a package. The body package name must match the resource identifier"
      parameters:
       - in: body
         name: name
         schema:
          properties:
            name:
              type: "string"
              example: "com.example"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
    delete:
      tags:
        - Data Redaction
      summary: "Delete package"
      description: "Delete package"
      responses:
        200:
          description: OK
        404:
          description: NOT FOUND
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/views:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
    get:
      tags:
        - Views
      summary: "List Views"
      description: "List Views"
      responses:
        200:
          description: List of views including basic info about each view.
          schema:
            properties:
              views:
                type: "array"
                items:
                  $ref: "#/definitions/ViewBasic"
        401:
          $ref: "#/definitions/UnauthorizedError"
    post:
      tags:
        - Views
      summary: "Create View"
      description: "Create View"
      parameters:
        - in: body
          name: view
          description: Single view properties
          schema:
              $ref: "#/definitions/ViewFull"
      responses:
        201:
          description: CREATED
        400:
          description: BAD INPUT
        409:
          description: CONFLICT
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/views/{view_id}:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: view_id
          description: View to use
          type: string
          required: true
    get:
      tags:
        - Views
      summary: "Get View properties"
      description: "Get full list of view properties"
      responses:
        200:
          description: Full list of view properties
          schema:
            properties:
              views:
                type: "array"
                items:
                  type: "object"
                  description: Single view full properties
                  properties:
                    id:
                      type: "string"
                      example: P12
                    name:
                      type: "string"
                      example: DB Errors
                    description:
                      type: "string"
                      example: This is a DB Errors View
                    shared:
                      type: boolean
                      example: false
                    admin:
                      type: boolean
                      description: TBD - NOT YET IMPLEMENTED
                      example: true
                    default:
                      type: boolean
                      description: TBD - NOT YET IMPLEMENTED
                      example: false
                    filters:
                      type: "array"
                      items:
                        $ref: "#/definitions/Filter"
                    alert_on_new:
                      type: boolean
                      description: TBD - NOT YET IMPLEMENTED
                      example: true
                    alert_on_anomaly:
                      type: boolean
                      description: TBD - NOT YET IMPLEMENTED
                      example: true
        401:
          $ref: "#/definitions/UnauthorizedError"
    post:
      tags:
        - Views
      summary: "Edit view data"
      description: "Edit view data"
      parameters:
        - in: body
          name: view
          description: Single view properties
          schema:
              $ref: "#/definitions/ViewFull"
      responses:
        200:
          description: OK
        404:
          $ref: "#/definitions/NotFoundError"
        401:
          $ref: "#/definitions/UnauthorizedError"
  /services/{service_id}/views/{view_id}/metrics/view/graph:
    get:
      tags:
        - View Metrics
      summary: "Fetch event metrics"
      description: "Fetch event metrics"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: view_id
            description: View to use
            type: string
            required: true
          - in: query
            name: from
            type: string
            description: Start time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: to
            type: integer
            description: End time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: points
            type: integer
            description: Number of data points to return within the interval
            required: true
          - in: query
            name: server
            type: string
            description: Server(s) added to the filter
          - in: query
            name: app
            type: string
            description: Application(s) added to the filter
          - in: query
            name: deployment
            type: string
            description: Deployment(s) added to the filter
      responses:
        200:
          description: Event metrics
          schema:
            properties:
              graphs:
                type: "array"
                items:
                  type: "object"
                  properties:
                    type:
                      type: "string"
                      example: "event"
                    id:
                      type: "string"
                      example: "42"
                    points:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          time:
                            type: "string"
                            example: "2018-02-28T22:47:09.038Z"
                          value:
                            type: "number"
                            example: 42
                          contributors:
                            type: "array"
                            items:
                              type: "object"
                              properties:
                                id:
                                  type: "string"
                                  example: "42"
                                value:
                                  type: "number"
                                  example: 42
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
  /services/{service_id}/views/{view_id}/metrics/entrypoint/graph:
    get:
      tags:
        - View Metrics
      summary: "Fetch Event metrics split by entrypoint"
      description: "Fetch Event metrics split by entrypoint"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: view_id
            description: View to use
            type: string
            required: true
          - in: query
            name: from
            type: string
            description: Start time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: to
            type: integer
            description: End time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: points
            type: integer
            description: Number of data points to return within the interval
            required: true
          - in: query
            name: server
            type: string
            description: Server(s) added to the filter
          - in: query
            name: app
            type: string
            description: Application(s) added to the filter
          - in: query
            name: deployment
            type: string
            description: Deployment(s) added to the filter
      responses:
        200:
          description: Event metrics split by entry point
          schema:
            properties:
              graphs:
                type: "array"
                items:
                  type: "object"
                  properties:
                    type:
                      type: "string"
                      example: "event"
                    id:
                      type: "string"
                      example: "42"
                    points:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          time:
                            type: "string"
                            example: "2018-02-28T22:47:09.038Z"
                          value:
                            type: "number"
                            example: 42
                          contributors:
                            type: "array"
                            items:
                              type: "object"
                              properties:
                                id:
                                  type: "string"
                                  example: "42"
                                value:
                                  type: "number"
                                  example: 42
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
  /services/{service_id}/views/{view_id}/metrics/event/graph:
    get:
      tags:
        - View Metrics
      summary: "Fetch event metrics split by event"
      description: "Fetch event metrics split by event"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: view_id
            description: View to use
            type: string
            required: true
          - in: query
            name: from
            type: string
            description: Start time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: to
            type: integer
            description: End time of requested graph. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
            required: true
          - in: query
            name: points
            type: integer
            description: Number of data points to return within the interval
            required: true
          - in: query
            name: server
            type: string
            description: Server(s) added to the filter
          - in: query
            name: app
            type: string
            description: Application(s) added to the filter
          - in: query
            name: deployment
            type: string
            description: Deployment(s) added to the filter
      responses:
        200:
          description: event metrics split by event
          schema:
            properties:
              graphs:
                type: "array"
                items:
                  type: "object"
                  properties:
                    type:
                      type: "string"
                      example: "event"
                    id:
                      type: "string"
                      example: "42"
                    points:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          time:
                            type: "string"
                            example: "2018-02-28T22:47:09.038Z"
                          value:
                            type: "number"
                            example: 42
                          contributors:
                            type: "array"
                            items:
                              type: "object"
                              properties:
                                id:
                                  type: "string"
                                  example: "42"
                                value:
                                  type: "number"
                                  example: 42
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
  /services/{service_id}/alerts/{view_id}/anomaly:
    post:
      tags:
        - Alerts
      summary: "Alert on anomalies"
      description: "Alert on anomalies"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: view_id
            description: View to use
            type: string
            required: true
          - in: body
            name: anomaly
            description: "the anomaly object"
            schema:
              type: "object"
              properties:
                desc:
                  type: "string"
                  example: "Description"
                timeframe:
                  type: "object"
                  properties:
                    from:
                      type: "string"
                      example: "2018-02-28T22:47:09.038Z"
                    to:
                      type: "string"
                      example: "2018-03-01T22:47:09.038Z"
                    name:
                      type: "string"
                      example: "Last day"
                anomaly:
                  type: "object"
                  properties:
                    periods:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          id:
                            type: "string"
                            example: "1"
                          from:
                            type: "string"
                            example: "2018-03-01T23:10:00.000Z"
                          to:
                            type: "string"
                            example: "2018-03-01T24:10:00.000Z"
                    contributors:
                      type: "array"
                      items:
                        type: "object"
                        properties:
                          id:
                            type: "number"
                            example: 1
                          value:
                            type: "number"
                            example: 42
      responses:
        200:
          OK
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
  /services/{service_id}/labels:
    parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
    get:
        tags:
          - Labels
        summary: "List labels"
        description: "List all existing labels"
        responses:
          200:
            description: List of labels
            schema:
              properties:
                labels:
                  type: "array"
                  items:
                    $ref: "#/definitions/Label"
          401:
            $ref: "#/definitions/UnauthorizedError"
    post:
      tags:
        - Labels
      summary: "Create new label"
      description: "Create new label"
      parameters:
        - in: body
          name: label
          description: Single label
          schema:
            $ref: "#/definitions/Label"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
        409:
          description: CONFLICT
  /services/{service_id}/events/{event_id}:
    get:
      tags:
        - Events
      summary: "Fetch event data"
      description: "Fetch event data"
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: event_id
            description: Event to use
            type: string
            required: true
      responses:
        200:
          description: Event data
          schema:
            $ref: "#/definitions/Event"
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
  /services/{service_id}/events/{event_id}/labels:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: event_id
          description: Event to use
          type: string
          required: true
    post:
      tags:
        - Labels
      summary: "Add/Remove labels"
      description: "Append/Detach labels to/from event"
      parameters:
        - in: body
          name: add
          description: list of label names to append
          schema:
            properties:
              add:
                type: "array"
                items:
                  type: "string"
                  example: "Critical"
        - in: body
          name: remove
          description: list of label names to detach from event
          schema:
            properties:
              remove:
                type: "array"
                items:
                  type: "string"
                  example: "Low"
      responses:
        200:
          description: OK
        400:
          description: BAD INPUT
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          description: NOT FOUND
  /services/{service_id}/events/{event_id}/inbox:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: event_id
          description: Event to use
          type: string
          required: true
    post:
      tags:
        - Labels
      summary: "Move to Inbox"
      description: "Move the specified event into Inbox"
      responses:
        200:
          description: OK
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          description: NOT FOUND
  /services/{service_id}/events/{event_id}/delete:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: event_id
          description: Event to use
          type: string
          required: true
    post:
      tags:
        - Labels
      summary: "Move to Trash"
      description: "Move the specified event into Trash"
      responses:
        200:
          description: OK
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          description: NOT FOUND
  /services/{service_id}/events/{event_id}/resolve:
    parameters:
        - in: path
          name: service_id
          description: Environment to use
          type: string
          required: true
        - in: path
          name: event_id
          description: Event to use
          type: string
          required: true
    post:
      tags:
        - Labels
      summary: "Mark as resolved"
      description: "Marks the specified event as resolved"
      responses:
        200:
          description: OK
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          description: NOT FOUND
  /services/{service_id}/events/${event_id}/snapshot:
    get:
      tags:
        - Events
      summary: "Fetch event snapshot"
      description: "Fetch event snapshot.
        Fetches the last relevant snapshot for the specific filters provided.
        All filters are optional."
      parameters:
          - in: path
            name: service_id
            description: Environment to use
            type: string
            required: true
          - in: path
            name: event_id
            description: Event to use
            type: string
            required: true
          - in: query
            name: from
            type: string
            description: Start time of requested timeframe. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
          - in: query
            name: to
            type: integer
            description: End time of requested timeframe. Date in ISO8601 format (yyyy-MM-ddTHH:mm:ss.SSSZ)
          - in: query
            name: server
            type: string
            description: Server(s) added to the filter
          - in: query
            name: app
            type: string
            description: Application(s) added to the filter
          - in: query
            name: deployment
            type: string
            description: Deployment(s) added to the filter
          - in: query
            name: similar_event_id
            type: string
            description: Event(s) added to the filter
      responses:
        200:
          description: Link to snapshot
          schema:
            type: "object"
            properties: 
              link: 
                type: "string"
                example: "https://app.overops.com/tale.html?event=Ux42fkaa--"
        401:
          $ref: "#/definitions/UnauthorizedError"
        404:
          $ref: "#/definitions/NotFoundError"
definitions:
  UnauthorizedError:
    type: object
    properties:
      code:
        type: integer
        format: int32
        example: 401
      type:
        type: string
        example: Unauthorized
      message:
        type: string
        example: Not authorized to perform action
  NotFoundError:
    type: object
    properties:
      code:
        type: integer
        format: int32
        example: 404
      type:
        type: string
        example: Resource Not Found
      message:
        type: string
        example: Resource Not Found
  Pattern:
    description: A data redaction pattern used to define PII RegEx
    type: object
    properties:
      name:
        type: "string"
        example: "Visa"
      category:
        type: "string"
        example: "Credit Card"
      regex:
        type: "string"
        example: "\\b4\\d{3}([\\-\\ ]?)(?:\\d{4}\\1){2}\\d(?:\\d{3})?\\b"
      is_active:
        type: "boolean"
        example: true
  IncludedClassName:
    type: string
    example: "com.company.GoodClassName"
  IncludedPackageName:
    type: string
    example: "com.company.package.good"
  ExcludedClassName:
    type: string
    example: "com.company.BadClassName"
  ExcludedPackageName:
    type: string
    example: "com.company.package.bad"
  ViewBasic:
    type: "object"
    properties:
      id:
        type: "string"
        example: P12
      name:
        type: "string"
        example: DB Errors
      shared:
        type: boolean
        example: false
  ViewFull:
    type: "object"
    description: Single view full properties
    properties:
      name:
        type: "string"
        example: DB Errors
      description:
        type: "string"
        example: This is a DB Errors View
      shared:
        type: boolean
        example: false
      admin:
        type: boolean
        description: TBD - NOT YET IMPLEMENTED
        example: true
      default:
        type: boolean
        description: TBD - NOT YET IMPLEMENTED
        example: false
      filters:
        type: "array"
        items:
          $ref: "#/definitions/Filter"
      alert_on_new:
        type: boolean
        description: TBD - NOT YET IMPLEMENTED
        example: true
      alert_on_anomaly:
        type: boolean
        description: TBD - NOT YET IMPLEMENTED
        example: true
  Filter:
    description: Filter properties
    type: "object"
    properties:
      name:
        type: "string"
        description: Use a filter name from the list above.
        enum: [SERVERS, APPS, DEPLOYMENTS, FIRST SEEN CUSTOM, FIRST SEEN PRESET, EVENT TYPE, EVENT NAME, EVENT LOCATION, EVENT PACKAGE, ENTRY POINT, LABELS, INTRODUCED BY, SEARCH]
      values:
        type: "array"
        description: The values that shall be filtered. Follow the examples to define proper value format that matches desired filter type.
        items:
          type: "string"
    example:
      general_example:
        name: LABELS
        value: ["JIRA", "CRITICAL", "QA"]
      event_type_example:
        name: EVENT TYPE
        value: ["Uncaught exceptions", "Swallowed Exceptions"]
        summary: Supported values - Uncaught exceptions, Caught exceptions, Swallowed Exceptions, Logged Warnings, Logged Errors, HTTP Errors, Timers.
      first_seen_custom_example:
        name: FIRST SEEN CUSTOM
        value: ["from= 2018-02-28T22:47:09.038Z", "to=2018-03-01T22:47:09.038Z"]
        summary: use this example to define FIRST SEEN CUSTOM filter with fixed time range (ISO8601 format)
      first_seen_preset_example:
        name: FIRST SEEN PRESET
        value: last_hour
        summary: use this example to define FIRST SEEN PRESET filter. Available presets - last_hour, last_24h, last_7d, last_30d
      search_example:
        name: SEARCH
        value: ["Can not find"]
        summary: use this example to define SEARCH filter - only single search value can be defined
  Event:
    description: An exception, logged error and more
    type: object
    properties:
      id:
        type: "string"
        example: "1"
      summary:
        type: "string"
        example: "NullPointerException in Main.main"
      type:
        type: "string"
        example: "NullPointerException"
      first_seen:
        type: "string"
        example: "2018-02-28T22:47:09.038Z"
      introduced_by:
        type: "string"
        example: "1.201.1"
      labels:
        type: "array"
        items:
          type: "string"
          example: "Critical"
      similar_event_ids:
        type: "array"
        items:
          type: "string"
          example: "K2"
      error_location:
        $ref: "#/definitions/CodeLocation"
      entry_point:
        $ref: "#/definitions/CodeLocation"
  Label:
    type: object
    properties:
      name:
        type: string
        example: HighPriority
      type:
        type: "string"
        enum:
          - DEFAULT
          - USER
        example: USER
      color: #consider adding available colors as enum
        type: string
        example: RED
  CodeLocation:
    description: A code location, for error location, etc
    type: object
    properties:
      prettified_name:
        type: "string"
        example: "Main.main"
      class_name:
        type: "string"
        example: "com.company.Main"
      method_name:
        type: "string"
        example: "main"
      method_desc:
        type: "string"
        example: "([Ljava/lang/String;)V"
